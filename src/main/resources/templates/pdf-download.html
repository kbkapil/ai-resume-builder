<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Resume - AI Resume Builder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }
        .success-icon {
            width: 80px;
            height: 80px;
            background: #28a745;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">AI Resume Builder</a>
        </div>
    </nav>

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-6">
                <div class="card shadow text-center">
                    <div class="card-body">
                        <div class="success-icon">
                            <svg width="40" height="40" fill="currentColor">
                                <path d="M16.707 5.293a1 1 0 0 0-1.414 0L8 12.586l-3.293-3.293a1 1 0 0 0-1.414 1.414l4 4a1 1 0 0 0 1.414 0l8-8a1 1 0 0 0 0-1.414z"/>
                            </svg>
                        </div>
                        <h2 class="card-title mb-4">Resume Generated Successfully!</h2>
                        <p class="card-text mb-4">
                            Your AI-enhanced resume has been created with the selected template.
                            Click the button below to download your PDF resume.
                        </p>

                        <form method="post" th:action="@{/download}" style="display: none;">
                            <input type="hidden" name="name" th:value="${resume.name}">
                            <input type="hidden" name="email" th:value="${resume.email}">
                            <input type="hidden" name="phone" th:value="${resume.phone}">
                            <input type="hidden" name="address" th:value="${resume.address}">
                            <input type="hidden" name="summary" th:value="${resume.summary}">
                            <input type="hidden" name="skills" th:value="${resume.skills}">
                            <input type="hidden" name="targetJobRole" th:value="${resume.targetJobRole}">
                            <input type="hidden" name="template" th:value="${resume.template}">
                        </form>

                        <div class="d-grid gap-2">
                            <button onclick="downloadPdf()" class="btn btn-primary btn-lg">
                                <svg width="20" height="20" fill="currentColor" class="me-2">
                                    <path d="M.5 3l.04.87a1.99 1.99 0 0 0-.22 1.99L2.5 13.5a2 2 0 0 0 1.99 1.99h7.02a2 2 0 0 0 1.99-1.99L15.68 5.87A2 2 0 0 0 13.69 4H.5z"/>
                                </svg>
                                Download PDF Resume
                            </button>
                            <a href="/create" class="btn btn-outline-secondary">
                                Create Another Resume
                            </a>
                        </div>

                        <div class="mt-4 p-3 bg-light rounded">
                            <h6>Resume Details:</h6>
                            <p class="mb-1"><strong>Name:</strong> <span th:text="${resume.name}">John Doe</span></p>
                            <p class="mb-1"><strong>Template:</strong> <span th:text="${resume.template}">Professional</span></p>
                            <p class="mb-0"><strong>Target Role:</strong> <span th:text="${resume.targetJobRole}">Software Engineer</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function downloadPdf() {
            // Create a simple text resume content
            var resumeText = "RESUME - " + getTemplateName() + " TEMPLATE\n\n";
            resumeText += "Name: " + getValue("resume.name") + "\n";
            resumeText += "Email: " + getValue("resume.email") + "\n";
            resumeText += "Phone: " + getValue("resume.phone") + "\n";

            if (getValue("resume.address")) {
                resumeText += "Address: " + getValue("resume.address") + "\n";
            }

            resumeText += "\nSUMMARY\n";
            resumeText += getValue("resume.summary") + "\n\n";

            resumeText += "SKILLS\n";
            resumeText += getValue("resume.skills") + "\n\n";

            resumeText += "TARGET JOB ROLE\n";
            resumeText += getValue("resume.targetJobRole") + "\n";

            // Create a blob URL
            const blob = new Blob([resumeText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);

            // Create a temporary link and trigger download
            const link = document.createElement('a');
            link.href = url;
            link.download = 'resume_' + new Date().getTime() + '.txt';
            document.body.appendChild(link);
            link.click();

            // Clean up
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            // Show success message
            alert('Resume downloaded successfully!');
        }

        function getValue(field) {
            // This is a simplified approach - in a real implementation,
            // you would pass the resume data from the server
            return "Sample data"; // Placeholder
        }

        function getTemplateName() {
            return "Professional"; // Placeholder
        }
    </script>
</body>
</html>
